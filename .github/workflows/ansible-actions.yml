name: Ansible Actions

on: 
  push:
    branches:
      - "main"

jobs:
    deploy:
        runs-on: ubuntu-20.04
        
        steps:
          - run: echo "GitHub Actions TF"

          - name: Checkout
            uses: actions/checkout@v2
          
          - name: AWS Authentication
            uses: aws-actions/configure-aws-credentials@v1
            with:
              role-to-assume: arn:aws:iam::254964228601:role/elk1-github-oidc
              aws-region: us-east-1
              role-session-name: GitHubActionsTF

          - name: Perform ansible playbook to deploy
            uses: actions-ansible@v2
            with:
              playbook: ./ansible/main-playbook.yml